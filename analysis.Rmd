---
title: "NOK/EUR Regression"

author: "Eric Eikrem"
date: "October 2, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("xml2")
library("dplyr")
library("ggplot2")
```

## NOK vs EUR Regression

```{r, results='asis'}
analysis_periods <- c(10,15,20,30,50,80,130,210,340)
dates_closed <- c()
nok_eur_obs <- c()

nok_eur <- function(days) {
  
  url_to_read <- paste(
    "https://data.norges-bank.no/api/data/EXR/",
    "B.EUR.NOK.SP?lastNObservations=",
    days,
    sep = ""
  )
  
  nok_eur_obs <- read_xml(url_to_read) %>%
    xml_find_all("//Obs")
  
  dates_closed <- nok_eur_obs %>% 
    xml_attr("TIME_PERIOD") %>% 
    as.Date("%Y-%m-%d")
  
  nok_eur_daily <- nok_eur_obs %>% 
    xml_attr("OBS_VALUE") %>% 
    as.numeric()
  
  data.frame(x = dates_closed, y = nok_eur_daily)
}

nok_eur_plot <- function(nok_eur_data, regression_method) {
  
  g <- ggplot(
    nok_eur_data, 
    aes(x = x, y = y)
    ) +
    geom_point() +
    geom_smooth(method = regression_method) +
    labs(
      title = "NOK / EUR",
      subtitle = paste(length(nok_eur_data$x), "days", sep = " "),
      y = "NOKs per EUR",
      x = "Time-period",
      caption = paste("NOK per EUR for a time-period of", length(nok_eur_data$x), "days", sep = " ") 
    )
  
  plot(g)
}

for(no_days in analysis_periods) {
  
  nok_eur_plot(nok_eur(no_days), "auto")
  nok_eur_plot(nok_eur(no_days), "lm")
  
}
```

